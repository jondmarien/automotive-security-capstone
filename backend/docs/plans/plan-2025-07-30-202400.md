# RTL-SDR/NFC Integration: Task 6 Plan

## Notes
- Task 6 will implement a demonstration/testing framework for realistic signal validation.
- The `--synthetic` flag must work alongside `--mock` (i.e., only active when both are set).
- Existing mock event generation must remain unchanged when only `--mock` is set.
- Synthetic signal generation and validation framework will only be used when both flags are enabled.
- Updates must be reflected in all relevant docs/specs as implementation progresses.
- Follow all project rules and include docs in @.kiro/steering for implementation.
- Centralize scenario/attack types, key fob frequencies, and modulations in a shared enum/utils file to reduce code duplication and improve maintainability.
- NFC tag types and authentication status are now centralized in signal_constants.py and used across event generation logic for consistency.
- All synthetic event generation functions (key fob, replay, jamming, brute force) have been removed from cli_dashboard.py and are now only implemented in cli_dashboard_detection_adapter.py. This avoids duplication and ensures all synthetic logic uses centralized constants/enums.
- [x] Refactor synthetic event generation: move, rename, and centralize constants as planned.
- [x] Synthetic event threat variety, timestamp format, and evidence structure fixed and verified.
- [x] Evidence structure for all synthetic event types (including replay and jamming attacks) fixed and verified.
- Synthetic event sequence is currently deterministic; user requested randomization/mixing of event types for more realistic testing.
- [x] CLI dashboard line highlighting and scrolling sometimes fails with synthetic events; fix UI/UX regression for event highlighting and scrolling when using synthetic mode.
- [x] CLI dashboard navigation, pagination, and highlighting polished and stable.
- Pagination (10 events per page) has been implemented for the event table, with page counter at the bottom right.
- [x] Pagination navigation now uses left/right arrow keys and help text is accurate.
- [x] Page counter: always render `Page 1/1` when only one page, even if <10 events; ensure counter is visible and updates correctly with navigation. If not robust, implement pagination using Rich's Pager component for large tables.
- Timestamp formatting will use a constant defined in signal_constants.py, referenced in both cli_dashboard.py and cli_dashboard_detection_adapter.py for consistency.
- [x] Added standardized timestamp format constant to signal_constants.py.
- [x] Reference timestamp format constant in event generation and dashboard rendering code.
- [x] Debug and fix custom pagination logic so table and counter update with navigation, per user request.
- [x] Fix UnboundLocalError: ensure needs_full_refresh is in correct scope so dashboard does not crash on pagination refresh.
- Note: Custom pagination is now robust; if future requirements demand, consider migrating to Rich's Pager for large-table navigation (see code/docs for this note).
- Root cause: needs_full_refresh must be declared as nonlocal in the renderer coroutine and initialized in the parent function/scope to avoid UnboundLocalError.
- Next step: Final user validation of dashboard pagination and navigation.
- See @.kiro/steering, code-guide.md, tool-usage.md, and all backend/docs for implementation guidance.

## Task List
- [x] 6.1 Build test signal generation framework with `--synthetic` flag
  - [x] Implement `--synthetic` CLI flag that works alongside `--mock` flag
  - [x] Ensure backward compatibility with existing mock event generation
  - [x] Create synthetic key fob signal generation with realistic characteristics
  - [x] Implement replay attack simulation using recorded signals
  - [x] Add jamming signal generation for interference testing
  - [x] Build brute force attack simulation scenarios
  - [x] Refactor: Rename `generate_synthetic_events` to `generate_synthetic_event`
  - [x] Refactor: Move `generate_synthetic_event` and all `generate_synthetic_*_attack` helpers to backend/cli_dashboard_detection_adapter.py
  - [x] Refactor: In `generate_mock_events`, delegate to synthetic generator if synthetic flag is set
  - [x] Centralize scenario/attack types and signal constants (frequencies, modulations) in a shared enum or utils file
- [x] 6.1b Refactor generate_detection_event to use enums/constants from utils.signal_constants
- [x] 6.1c Review/refactor any remaining event generation logic to use centralized enums/constants
- [ ] 6.2 Implement detection accuracy validation
  - [-] Create automated testing for >90% classification accuracy
  - [-] Build confusion matrix generation for detection performance
  - [-] Add statistical analysis for detection confidence validation
  - [-] Implement benchmark testing against known attack patterns
  - [-] Optimize performance testing for real-time processing validation (100ms signal chunks, <500ms processing time)
- [x] 6.3 Create demonstration scenario framework
  - [x] Fix CLI dashboard line highlighting and scrolling for synthetic events
  - [x] Implement pagination for event table (10 events per page, page counter)
  - [x] Pagination navigation uses left/right arrow keys, help text updated
  - [x] Add standardized timestamp format constant to signal_constants.py
  - [x] Reference timestamp format constant in event generation and dashboard rendering code
  - [x] Fix dashboard shaking issue by stabilizing table refresh behavior
  - [x] Page counter: always render `Page 1/1` when only one page, even if <10 events; ensure counter is visible and updates correctly with navigation. If not robust, implement pagination using Rich's Pager component for large tables.
  - [-] Build scripted demonstration sequences for capstone presentation
  - [ ] Add technical evidence display for professor evaluation
  - [ ] Create compelling visual demonstrations of detection capabilities
  - [ ] Ensure seamless integration with existing CLI dashboard
  - [x] Note: Unicode (emoji) logging causes cp1252 errors on Windows; use ASCII/logging-safe symbols.
  - Note: Integrate Signal Cloning and Relay attacks directly into event generation, demonstration scripts, and validation (main adapter file only).
  - Note: Jamming attack generator restored and lint errors being addressed.
  - Note: Lint and indentation errors in attack event generation code are being addressed.
  - Note: Brute force attack event generation logic (manufacturer-specific params, key_fob_id, rolling_code, signal params) is being restored as requested.
  - Note: Brute force attack event generation logic is being restored per user request.
  - [x] Note: Brute force attack generator KEY_FOB_FREQUENCIES bug fixed; all synthetic attack generators now correct.
  - Note: Detection accuracy validation failed (81% < 90%); confusion matrix analysis required. Investigate low recall for signal cloning, relay, and jamming attacks, and precision for benign class.
  - [-] Analyze confusion matrix and detection logic to identify causes of low recall/precision
  - [x] Ensure all attack vectors (Normal, Replay, Jamming, Brute Force, Signal Cloning, Relay) are included in detection accuracy validation and confusion matrix generation scripts.
  - [x] Implement Signal Cloning attack scenario in synthetic/mock event generation
  - [x] Implement Relay attack scenario in synthetic/mock event generation
  - [x] Add Signal Cloning and Relay attacks to demonstration scenarios and validation scripts
  - [x] Review and ensure CLI dashboard uses detection logic from backend/detection
  - [x] Ensure validate_detection_accuracy.py and related scripts use all attack vectors
  - [x] Ensure confusion matrix generation covers all attack types
- [x] 6.4 Fix UnboundLocalError with needs_full_refresh variable scope.
- [ ] Finalize and validate demonstration scenario framework with user testing.

## Current Goal
Re-run detection accuracy validation and confirm all attack types.